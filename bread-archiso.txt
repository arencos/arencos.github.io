her şeyden önce yardımcı olabilecek bir link koyuyorum buraya
https://wiki.archlinux.org/title/Archiso
burada kernel değiştirme vs. anlatılıyor oradan yaparsın ben yapmadım



ilk önce archiso kur
pacman -S archiso
ondan sonra archiso releng profilini kopyala yani:
cp -r /usr/share/archiso/configs/profile/ ~/breadlinux
ondan sonra o klasöre gir
cd ~/breadlinux

şimdi bu klasörde bir kaç tane klasör ve dosya var
packages.x86_64 live environmentta olacak paketler yani bu dosyanın sonuna firefox eklersen firefox kurulacak
airootfs diye bir klasör var, bu klasör filesystem yani buraya attığın dosyalar isoda da olacak / değişikliklerin isoda da olacak.
diğerleri şimdilik önemli değil

evet şimdi masaüstü ortamını özelleştirmek için kullanacağın xephyr aracını kur
pacman -S xorg-server-xephyr
bu araç biraz sonra işine yarayacak
display manager servisini aktif etmen lazım ona da şuradan bakabilirsin: https://wiki.archlinux.org/title/Archiso#Login_manager
buradan aynı anda otomatik logini de açabilirsin

şimdi, bir dosya oluşturman lazım direkt full pathi veriyorum
~/breadlinux/airootfs/root/customize_airootfs.sh

bu dosyayı aç ve içine bunları yapıştır (bu benim masaüstü ortamını vb. özelleştirmek için kullandığım ayarlar, iso oluşturulurken çalıştırılıyor ve isoya chrootlamanı sağlıyor)
(internetten çördüm ve özelleştirdim biraz)
------- customize_airootfs.sh ------
#!/bin/bash



set -e -u



sed -i 's/#\(en_US\.UTF-8\)/\1/' /etc/locale.gen

locale-gen



ln -sf /usr/share/zoneinfo/UTC /etc/localtime



usermod -s /usr/bin/zsh root

cp -aT /etc/skel/ /root/

chmod 700 /root



sed -i 's/#\(PermitRootLogin \).\+/\1yes/' /etc/ssh/sshd_config

sed -i "s/#Server/Server/g" /etc/pacman.d/mirrorlist

sed -i 's/#\(Storage=\)auto/\1volatile/' /etc/systemd/journald.conf



sed -i 's/#\(HandleSuspendKey=\)suspend/\1ignore/' /etc/systemd/logind.conf

sed -i 's/#\(HandleHibernateKey=\)hibernate/\1ignore/' /etc/systemd/logind.conf

sed -i 's/#\(HandleLidSwitch=\)suspend/\1ignore/' /etc/systemd/logind.conf





systemctl enable pacman-init.service choose-mirror.service

systemctl set-default multi-user.target

# NOTE THESE STEPS: THEY ARE VERY IMPORTANT

nano /etc/sudoers

useradd -m -G wheel bread

# Don't forget to add a password, otherwise you'll cannot access sudo later.

passwd bread

# This next step is the most important: it will permit us to "pause" the mkarchiso process and customize it regarding our needs.

su bread

pacman -Sy

pacman-key --init

pacman-key --populate archlinux
---- customize_airootfs.sh ----


şimdi isoyu oluşturmaya başlıyoruz bunun için de şu komutu kullanmamız lazım:
mkarchiso -v ~/breadlinux/

biraz bekle, ondan sonra /etc/sudoers dosyası açılacak. bu dosyada %wheel ALL falan yazan satırı bul ve o satırın başındakı # karakterini sil. ondan sonra kaydet
bundan sonra sana şifre soracak, bu şifre live kullanıcının şifresi oluyor. ben direkt bread yazıp geçiyorum. şifreyi doğrulaman gerek. ondan sonra chrootladın!
şimdi ben openbox için yapıyorum o yüzden komutlar openboxlu olacak sen onları kendine göre ayarla
yeni bir terminal aç ve şunu yaz:
Xephyr -br -ac -noreset -screen 800x600 :3

bir pencere açılacak, bunu kapatma
(openbox yapacaksan /etc/xdg/openbox/autostart dosyasına tint2 komutunu ekle)
şimdi iso olan terminale geri dön ve şunu yaz (openbox için bu)
sudo DISPLAY=:3 openbox-session
entera bas ondan sonra o açık olan xephyr penceresinde openbox veya hangi masaüstü ortamını seçtiysen onu göreceksin. özelleştirmelerini yap, ondan sonra iso açık olan
terminalde ctrl c'ye bas, ondan sonra xephyr'i kapayabilirsin. şimdi exit yaz iso olan terminalde, ve çıkmış olacaksın.
şimdi isoyu gerçekten yapmaya geliyoruz

şu komutu çalıştır
rm ~/breadlinux/work/x86_64/airootfs/root/customize_airootfs.sh
ondan sonra ~/breadlinux klasörüne geri dön ve şu komutu (yine) çalıştır:
mkarchiso -v ~/breadlinux/
bunun bitmesini bekle, bittiğinde ~/breadlinux/out diye bir klasör olacak, onun içinde de iso dosyası olacak.
(bunu yazmak çok uzun sürdü inşallah hata yoktur :D)
